<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>FO4 Achievement Checklist</title>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
 <style>
  body { font-family: sans-serif; padding: 1rem; background: #111; color: #eee; }
  h2 { border-bottom: 1px solid #444; margin-top: 2rem; }
  label { display: flex; align-items: center; margin: 0.5rem 0; }
  input[type="checkbox"] { margin-right: 0.5rem; }
  textarea { width: 100%; height: 60px; margin-top: 4px; background: #222; color: #eee; border: 1px solid #333; }
  .achievement { margin-bottom: 1rem; padding-bottom: 1rem; border-bottom: 1px dotted #444; }
  .locked { opacity: 0.6; font-style: italic; }
  .locked::before { content: "ðŸ”’ "; margin-right: 4px; }
  #proxyAchievements { margin-top: 2rem; padding: 1rem; border: 1px solid #555; background: #222; }
</style>

</head>
<body>
  <h1>Fallout 4 Achievement Checklist</h1>
  <p id="status">Loading...</p>
  <label><input type="checkbox" id="hideCheckedToggle"> Hide completed</label>
  <button id="logoutBtn" style="display: none;">Logout</button>
  <div id="checklist"></div>

  <h2>Proxy API Results (Test)</h2>
  <div id="proxyAchievements">Loading achievements from proxy...</div>

<script src="auth.js"></script>
<script>
  firebase.auth().onAuthStateChanged(user => {
    if (!user) {
      document.getElementById("proxyAchievements").innerText = "User not authenticated.";
      return;
    }

    user.getIdToken().then(token => {
      fetch("https://us-central1-fo4-checklist.cloudfunctions.net/getAchievements", {
        headers: {
          "Authorization": "Bearer " + token
        }
      })
      .then(res => res.json())
      .then(data => {
        const container = document.getElementById("proxyAchievements");
        if (!Array.isArray(data)) {
          container.innerText = "Unexpected response format.";
          return;
        }

        container.innerHTML = ""; // clear old content

        data.forEach((ach) => {
          const isAchieved = ach.progressState === "Achieved";
          const isLocked = ach.progressState === "NotStarted";
          const wrapper = document.createElement("div");
          wrapper.className = "achievement";
          if (isLocked) wrapper.classList.add("locked");
          wrapper.dataset.status = ach.progressState;

          const unlockedText = isAchieved
            ? new Date(ach.progression?.timeUnlocked).toLocaleString()
            : "";

          wrapper.innerHTML = `
            <strong>${ach.name}</strong><br>
            <em>Status:</em> ${isLocked ? "Locked" : ach.progressState}<br>
            <em>Unlocked:</em> ${unlockedText}<br><br>
          `;

          container.appendChild(wrapper);
        });

        const toggle = document.getElementById("hideCheckedToggle");
        toggle.addEventListener("change", () => {
          const hideCompleted = toggle.checked;
          document.querySelectorAll("#proxyAchievements .achievement").forEach(el => {
            el.style.display = (hideCompleted && el.dataset.status === "Achieved") ? "none" : "";
          });
        });
      })
      .catch(err => {
        document.getElementById("proxyAchievements").innerText =
          "Error loading achievements: " + err.message;
      });
    });
  });
</script>





</body>
</html>
